---
title: "Prairie Figures"
output: html_document
---

Master Rmd file for visualizing and graphing Prairie data

Collecting all figures and plots here to streamline workflow

#Setup and Loading
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Close graphics and clear local memory
graphics.off()
rm(list=ls())

#load libraries
library(ggplot2)
library(plyr)
library(data.table)
library(AER)
library(sandwich)
library(foreign)
library(rmarkdown)
library(lme4)
library(lmerTest)

#load data
cover=as.data.table(read.csv("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis/Cover_data_model.csv",header = T)) 

transect.master=as.data.table(read.csv("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis/Transect_master_V2.csv",header = T)) #use V2 after data issue

Indices.Yearly=as.data.table(read.csv("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis/Indices_Yearly.csv",header = T)) 

Indices.Monthly=as.data.table(read.csv("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis/Indices_Monthly.csv",header = T)) 

cover.climate=as.data.table(read.csv("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis/cover_climate.csv",header = T)) 


```

#Data Visualization
##Frequency

```{r Frequency}
# also visualize changes in frequency for all species but maybe break out by these categories (full visualization not just an average)

ggplot(unique(cover[!(Action==""),.(TransectID,Year, Freq.T,SpeciesID, Native.Status)]), aes(x = Year,y = Freq.T ,group = SpeciesID & TransectID))+
  geom_line() +
  geom_point() +
   facet_wrap(~Native.Status,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Species Freqeuncy", 
       x="Year",
       y="Frequency")


#Quick visualize
#ggplot(unique(cover[!(Action=="")&!(is.na(Freq.all)),.(Freq.all,Year,SpeciesID,Native.Status,Indicator)]), aes(x = Year,y = Freq.all,group = Year))+
  #geom_boxplot()+
  #stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  #facet_wrap(~Native.Status,nrow = 2)+
  #theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  #coord_cartesian(ylim = c(0, 0.05))+
  #labs(title="Species Average frequency by Year", 
       #x="Year",
       #y="Species Frequency")


 ggplot(unique(cover[!(Action=="")&!(is.na(change_f.all)),.(change_f.all,Year,SpeciesID,Native.Status,Indicator)]), aes(x = Year,y = change_f.all,group = Year))+
  geom_boxplot()+
  #stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Native.Status,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  coord_cartesian(ylim = c((-0.2), 0.25))+
  labs(title="Average change in species frequency by Year", 
       x="Year",
       y="Change in Species Frequency")
  
  ggplot(unique(cover[!(Action=="")&!(is.na(change_f.all)),.(change_f.all,Year,SpeciesID,Native.Status,Indicator)]), aes(x = Native.Status,y = change_f.all,group = Native.Status))+
  geom_boxplot()+
  #stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Year,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  coord_cartesian(ylim = c((-0.2), 0.25))+
  labs(title="Average change in species frequency by Status", 
       x="Year",
       y="Change in Species Frequency")

  
  stat_box_data <- function(y, upper_limit = 0.25) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}
  
  ggplot(unique(cover[!(Action=="")&!(is.na(change_f.all)) & !(Indicator==0), .(change_f.all,Year,SpeciesID,Native.Status,Indicator)]), aes(x = Indicator,y = change_f.all,group = Indicator))+
  geom_boxplot()+
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Year,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  coord_cartesian(ylim = c((-0.2), 0.25))+
  labs(title="Average change in species frequency by Status", 
       x="Year",
       y="Change in Species Frequency")

```

The above boxplots show frequency changes for each species averaged across sites. However this not only removes the ability to compare site effects but also treatment effects. Create new boxplots to examine impacts on species frequency without pre-averaging across sites. To avoid having to make a boxplot for each species, facet wrap by our categories. 

Freq.T = species frequency at each transect for that year. Later I look at the mean of these values by species categories. 

```{r Frequency Visualization - by species}

#First create a matrix of the plot types to make, use for loop to create boxplots
x.list = c("Year","Long.Cat","Lat.Cat")
y.list = c("Freq.T","change_f.tran")
Group = rep(c("Native.Status","Indicator"),each=length(x.list),times=length(y.list))
Y = rep(y.list,each = (length(Group)/length(unique(Group))))
X = c(rep(x.list,times = length(Y)/length(x.list)))
Action = c(rep(c("Action"),times = length(Y))) 

freq.vis = as.data.table(cbind(Y, X ,Group, Action))

# First create boxplots - species freq x Year/Lat/Long * Species Group * Action

for (i in 1:(freq.vis[,(length(Action)/2)])) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(freq.vis[i,Y]))))), eval(parse(text=(as.character(freq.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(freq.vis[i,Y])))))), 
              .(TransectID, SpeciesID, Action, Year, eval(parse(text=(as.character(freq.vis[i,Y])))), Lat.Cat,Long.Cat,Native.Status,Indicator)]), 
              aes(x = as.factor(eval(parse(text = (as.character(freq.vis[i,X]))))),  
                  y= V5, fill= eval(parse(text=(as.character(freq.vis[i,Group])))))) +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  coord_cartesian(ylim = c((-.02), 1))+
  labs(title= paste("Frequency - ",as.character(freq.vis[i,Y]), "by", as.character(freq.vis[i,X]), sep = " "), 
       x= as.character(freq.vis[i,X]),
       y= as.character(freq.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }

#Create boxplots - delta species freq x Year/Lat/Long * Species Group * Action
for (i in (freq.vis[,length(Action)]/2):freq.vis[,length(Action)]) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(freq.vis[i,Y]))))), eval(parse(text=(as.character(freq.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(freq.vis[i,Y])))))), 
              .(TransectID, SpeciesID, Action, Year, eval(parse(text=(as.character(freq.vis[i,Y])))), Lat.Cat,Long.Cat,Native.Status,Indicator)]), 
              aes(x = as.factor(eval(parse(text = (as.character(freq.vis[i,X]))))),  
                  y= V5, fill= eval(parse(text=(as.character(freq.vis[i,Group])))))) +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  coord_cartesian(ylim = c((-0.5), 0.5))+
  labs(title= paste("Frequency - ",as.character(freq.vis[i,Y]), "by", as.character(freq.vis[i,X]), sep = " "), 
       x= as.character(freq.vis[i,X]),
       y= as.character(freq.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }

#Look at delta F with facet wrap Species Category rather than Action
for (i in (freq.vis[,length(Action)]/2+1):freq.vis[,length(Action)]) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(freq.vis[i,Y]))))), eval(parse(text=(as.character(freq.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(freq.vis[i,Y])))))), 
              .(TransectID, SpeciesID, Action, Year, eval(parse(text=(as.character(freq.vis[i,Y])))), Lat.Cat,Long.Cat,Native.Status,Indicator)]), 
              aes(x = as.factor(eval(parse(text = (as.character(freq.vis[i,X]))))),  
                  y= V5, fill= Action)) +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ eval(parse(text=(as.character(freq.vis[i,Group])))),nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  coord_cartesian(ylim = c((-0.5), 0.5))+
  labs(title= paste("Frequency - ",as.character(freq.vis[i,Y]), "by", as.character(freq.vis[i,X]), sep = " "), 
       x= as.character(freq.vis[i,X]),
       y= as.character(freq.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }

```

Visualize Frequency 
- create plots to examine frequency over time, latitude, longitude * action for transects and mgmt units

```{r Frequency Visualization Setup}

#First create a matrix of the plot types to make, use for loop to create boxplots
x.list = c("Year","Long.Cat","Lat.Cat")
y.list = rep(c(as.character(freq.list[,1]),freq.list[,2]),times = length(x.list))
X = c(rep(x.list,each = length(y.list)/length(x.list)))
Action = c(rep(c("Action"),times = length(y.list))) 
Size = c(rep(c("TransectID","MGMTUNIT_I"),times = length(y.list)/2)) 

freq.vis = as.data.table(cbind(Y= y.list, X , Action, Size))

```

```{r Frequency Visualization - no action}

# First create boxplots to examing how varying levels of frequency changes over time and space

for (i in 1:(freq.vis[,length(Action)]/2)) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(freq.vis[i,Y]))))), eval(parse(text=(as.character(freq.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(freq.vis[i,Y])))))),.(MGMTUNIT_I,TransectID,Action,Year,eval(parse(text=(as.character(freq.vis[i,Y])))),Lat.Cat,Long.Cat)]), 
              aes(x = eval(parse(text=(as.character(freq.vis[i,X])))),y = V5, group= eval(parse(text=(as.character(freq.vis[i,X])))))) +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  #facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title= paste("Frequency - ",as.character(freq.vis[i,Y]), "by", as.character(freq.vis[i,X]), sep = " "), 
       x= as.character(freq.vis[i,X]),
       y= as.character(freq.vis[i,Y]))
  print(plot)
  
    }

```

```{r Frequency Visualization - action}

# Create boxplots showing frequency variation over time and space as a product of action

for (i in 1:(freq.vis[,length(Action)]/2)) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(freq.vis[i,Y]))))), eval(parse(text=(as.character(freq.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(freq.vis[i,Y])))))),.(MGMTUNIT_I,TransectID,Action,Year,eval(parse(text=(as.character(freq.vis[i,Y])))),Lat.Cat,Long.Cat)]), 
              aes(x = eval(parse(text=(as.character(freq.vis[i,X])))),y = V5, group= eval(parse(text=(as.character(freq.vis[i,X])))))) +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title= paste("Frequency - ",as.character(freq.vis[i,Y]), "by", as.character(freq.vis[i,X]), sep = " "), 
       x= as.character(freq.vis[i,X]),
       y= as.character(freq.vis[i,Y]))
  print(plot)
    }
 
```

##Cover

```{r Cover - Visualization Setup}

#Create boxplots evaluating cover relative to: time, lat, long * Species cat OR/AND MGMT Action

#create variable list to quickly replicate boxplots


x.list = c("Year","Long.Cat","Lat.Cat")
y.list = c(as.character(cover.list[,1]),as.character(cover.list[,2]))
y.list = y.list[ y.list != "change_cov.4.T" & y.list != "change_cov.4.M" ] #remove those which have no values
X = c(rep(x.list,each = length(y.list)))
Y = c(rep(y.list,times = length(x.list)))
Native = rep(c("Native.Status"),times=length(X))
Indicator =rep(c("Indicator"),times=length(X))
Action = rep(c("Action"),times=length(X))
Scale = rep(c(rep(c("TransectID","MGMTUNIT_I"),each =5) ,rep(c("TransectID","MGMTUNIT_I"),each =4)), times = (length(x.list)))
  
cover.vis = as.data.table(cbind(Y, X , Native, Indicator, Action, Scale))

```

```{r Cover - Visualization 1}

#First create boxplots by Native Status
for (i in 1:(cover.vis[,length(Action)])) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))), eval(parse(text=(as.character(cover.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))))
                  ,.(eval(parse(text=(as.character(cover.vis[i,Scale])))),Action,Year, SpeciesID,
                  eval(parse(text=(as.character(cover.vis[i,Y])))),Lat.Cat,Long.Cat,Native.Status)]), 
              aes(x = as.factor(eval(parse(text=(as.character(cover.vis[i,X]))))),y = V5, fill= Native.Status,))  +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ Action,nrow = 4)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title= paste("Species Cover - Method ",as.character(cover.vis[i,Y]), "by", as.character(cover.vis[i,X]), sep = " "), 
       x= as.character(cover.vis[i,X]),
       y= as.character(cover.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }

```

```{r Cover - Visualization 2}
#Now create boxplots by Indicator Status
for (i in 1:(cover.vis[,length(Action)])) {
  
  stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))), eval(parse(text=(as.character(cover.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))))
                  ,.(eval(parse(text=(as.character(cover.vis[i,Scale])))),Action,Year, SpeciesID,
                  eval(parse(text=(as.character(cover.vis[i,Y])))),Lat.Cat,Long.Cat,Indicator)]), 
              aes(x = eval(parse(text=(as.character(cover.vis[i,X])))),y = V5, fill= Indicator,))  +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ Action,nrow = 4)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title= paste("Species Cover - Method ",as.character(cover.vis[i,Y]), "by", as.character(cover.vis[i,X]), sep = " "), 
       x= as.character(cover.vis[i,X]),
       y= as.character(cover.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }

```

```{r Cover - Visualization 4}

#Plot cover by averaging by Native.Status for each transect/mgmgt unit

for (i in 1:(cover.vis[,length(Action)])) {
  
 stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))), eval(parse(text=(as.character(cover.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))))
                  ,.(eval(parse(text=(as.character(cover.vis[i,Scale])))),Action,Year,
                  eval(parse(text=(as.character(cover.vis[i,Y])))),Lat.Cat,Long.Cat,Native.Status)]
                    [,V4:=mean(V4),by=.(Year,V1,Native.Status)]), 
              aes(x = eval(parse(text=(as.character(cover.vis[i,X])))),y = V4, fill= Native.Status,))  +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ Action,nrow = 4)+ #maybe first wrap by year without actions broken out
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title= paste("Species Cover - Method ",as.character(cover.vis[i,Y]), "by", as.character(cover.vis[i,X]), sep = " "), 
       x= as.character(cover.vis[i,X]),
       y= as.character(cover.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }


```


```{r Cover - Visualization 5}
#Plot cover by averaging by  Indicators for each transect/mgmgt unit

for (i in 1:(cover.vis[,length(Action)])) {
  
 stat_box_data <- function(y, upper_limit = max (cover[!is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))), eval(parse(text=(as.character(cover.vis[i,Y]))))]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

plot = ggplot(unique(cover[!(Action=="")&!(is.na(eval(parse(text=(as.character(cover.vis[i,Y]))))))
                  ,.(eval(parse(text=(as.character(cover.vis[i,Scale])))),Action,Year,
                  eval(parse(text=(as.character(cover.vis[i,Y])))),Lat.Cat,Long.Cat,Indicator)]
                    [,V4:=mean(V4),by=.(Year,V1,Indicator)]), 
              aes(x = eval(parse(text=(as.character(cover.vis[i,X])))),y = V4, fill= Indicator,))  +
  geom_boxplot() +   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~ Action,nrow = 4)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title= paste("Species Cover - Method ",as.character(cover.vis[i,Y]), "by", as.character(cover.vis[i,X]), sep = " "), 
       x= as.character(cover.vis[i,X]),
       y= as.character(cover.vis[i,Y]),
       fill="Species Category")
  print(plot)
    }

```

##Tables and Plots for Presentations and Manuscript

```{r Miscellanous Plots and Tables}
#Tables and averages of transects, sites, and mgmt units
cover[,length(unique(TransectID)),by=MGMTUNIT_I][,mean(V1)]
cover[,length(unique(MGMTUNIT_I)),by=SITE_ID][,mean(V1)]

## Table number of management actions each year - one table for those during observed years and all years
write.table(table(unique(cover[!(Action==""),.(Action,Year,TransectID)])[,.(Action,Year)]),pipe("pbcopy"),sep = "\t") #observed years

#A bit more work to create a table of all management actions by year, regardless of observation
tab.action.all = rbind(transect.master[!(Mgmt.2010==""),.(Transect_I,Mgmt.2010)][,Year:=rep("2010",times=length(Transect_I))],
                       transect.master[!(Mgmt.2011==""),.(Transect_I,Mgmt.2011)][,Year:=rep("2011",times=length(Transect_I))],
                       transect.master[!(Mgmt.2012==""),.(Transect_I,Mgmt.2012)][,Year:=rep("2012",times=length(Transect_I))],
                       transect.master[!(Mgmt.2013==""),.(Transect_I,Mgmt.2013)][,Year:=rep("2013",times=length(Transect_I))],
                       transect.master[!(Mgmt.2014==""),.(Transect_I,Mgmt.2014)][,Year:=rep("2014",times=length(Transect_I))],
                       transect.master[!(Mgmt.2015==""),.(Transect_I,Mgmt.2015)][,Year:=rep("2015",times=length(Transect_I))],
                       transect.master[!(Mgmt.2016==""),.(Transect_I,Mgmt.2016)][,Year:=rep("2016",times=length(Transect_I))],
                       transect.master[!(Mgmt.2017==""),.(Transect_I,Mgmt.2017)][,Year:=rep("2017",times=length(Transect_I))],
                       transect.master[!(Mgmt.2018==""),.(Transect_I,Mgmt.2018)][,Year:=rep("2018",times=length(Transect_I))],
                       use.names=FALSE)

#Filter for transects I will actually use
tab.action.all = merge(tab.action.all,data.frame(Transect_I=cover[,unique(TransectID)]),by = "Transect_I")

write.table(table(tab.action.all[,.(Mgmt.2010,Year)]),pipe("pbcopy"),sep = "\t") #All years

##Management Acres
#Total
unique(cover[,.(ManUnitAcres,MGMTUNIT_I)])[!(is.na(ManUnitAcres)),sum(ManUnitAcres)]

##Total number of species and species richness histograms
#Total Species
cover[,length(unique(SpeciesID))]

#Total Species histogram
hist(unique(cover[!(is.na(sr_tran)),.(Year, TransectID, sr_tran)])[,sr_tran],freq = T,breaks = 0:65,main = "Species Richness by Transect",xlab = "Species Richness",ylab = "Nmber of Transects")

hist(unique(cover[!(is.na(ir_tran)),.(Year, TransectID, ir_tran)])[,ir_tran],freq = T,breaks = 0:20,main = "Invasive Richness by Transect",xlab = "Invasive Richness",ylab = "Number of Transects")

##Dominance
hist(unique(cover[,.(SpeciesID,Year,Native.Status,DI.T.2,TransectID)])[Native.Status=="I",sum(DI.T.2),by=.(Year,TransectID)][,V1],
     freq=F, breaks = seq(0,3,by = 0.05),main = "Invasive Dominance by Transect",xlab = "Invasive Dominance",ylab = "Number of Transects")

hist(unique(cover[,.(SpeciesID,Year,Native.Status,DI.T.2,TransectID)])[Native.Status=="N",sum(DI.T.2),by=.(Year,TransectID)][V1<7,V1],
     freq=F, breaks = seq(0,7,by = 0.05),main = "Native Dominance by Transect",xlab = "Native Dominance",ylab = "Number of Transects")
  
#Simple Plots for Hypotheses
#No effect 
a = runif(50,0,20)
b = runif(50,0,20)
rich = as.data.frame(cbind(a,b))

ggplot(data = rich, aes(x = a, y = b))+
  geom_point()+
  theme_minimal()+
  geom_smooth(method = lm,se = FALSE, size = 1,alpha = 1)+
   theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Growing Season Length Effect on Invasive Richness", x='Growing Season Length', y ='Invasive Richness')

#Positive Effect
a = runif(50,0,100)
b = runif(50,0,100)
a= sort(a)
b = sort(b)
b = sapply(b,function(x) x+runif(1,-20,20))

freq = as.data.frame(cbind(a,b))

ggplot(data = freq, aes(x = a, y = b))+
  geom_point()+
  theme_minimal()+
  geom_smooth(method = lm,se = FALSE, size = 1,alpha = 1)+
   theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Growing Season Length Effect on Invasive Frequency", x='Growing Season Length', y ='Invasive Frequency')

```

##Climate Visualization

Visualize Climate Variability
```{r monthly vis}
library(ggplot2)
for(t in 1:length(index.names)) {
plots = ggplot(indices.monthly.long[Index==index.names[t]],aes(x=Month,y=value,fill=Month))+
  geom_violin(trim=FALSE) +
  geom_boxplot(width=0.1,fill="white")+
  labs(title="Transect Climate Index Variability by Month") +
  ylab(index.names[t])+
  theme_classic() 
  
print(plots)
  }
```

Visualize the Yearly indices 
```{r yearly visualization}
library(ggplot2)
indices.yearly.long[,variable:=as.numeric(as.character(variable))]

for(t in 1:length(index.names)) {
plots = ggplot(indices.yearly.long[Index==index.names[t] & variable>2009],aes(x=as.factor(variable),y=value,fill=as.factor(variable)))+
  geom_violin(trim=FALSE) +
  geom_boxplot(width=0.1,fill="white")+
  labs(title="Transect Climate Yearly-Index Variability") +
  ylab(index.names[t])+
  xlab("Year")+
  theme(legend.position = "none")
  
print(plots)
  }

```



##Species Richness
```{r Species Richness}

# plot them
hist(unique(cover[!(is.na(change_sr_tran))][,.(Year,TransectID,change_sr_tran)])[,change_sr_tran],freq = T,main = "SR First Diff - Transects",xlab = "Delta SR",ylab = "Number of Transects",breaks = 100)

hist(unique(cover[!(is.na(change_sr_mgmt))][,.(Year,MGMTUNIT_I,change_sr_mgmt)])[,change_sr_mgmt],freq = T,main = "SR First Diff - MGMT Units",xlab = "Delta SR",ylab = "Number of MGMT Units",breaks = 100)

hist(unique(cover[!(is.na(change_sr_site))][,.(Year,SITE_ID,change_sr_site)])[,change_sr_site],freq = T,main = "SR First Diff - Sites",xlab = "Delta SR",ylab = "Number of Sites",breaks = 100)
     
#Clearly there is some craziness going on for some years, e.g. Transect 555 in 2015 only has 1 species (Poa) which is only given 1-5% cover. In 2012 there were 27 species and in 2018 there were 36. Rhett Johnson was obs

xx.1 = change_sr_tran[change_sr_tran>20,TransectID]
unique(cover[TransectID %in% xx.1,.(TransectID,Year,ObsCode,change_sr_tran,sr_tran,SITE_ID)])[order(TransectID),][!(is.na(sr_tran)),] 


xx.2 = change_sr_tran[change_sr_tran<(-20),TransectID]
unique(cover[TransectID %in% xx.2,.(TransectID,Year,ObsCode,change_sr_tran,sr_tran,SITE_ID)])[order(TransectID),][!(is.na(sr_tran)),] 

#make a table for Daren to correct these issues...just past in the two tables above

```

```{r Richness - Action}
#Plot hist of change in SR by Action and Year
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_sr_tran),change_sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_sr_tran)),.(TransectID,Year,change_sr_tran,Action)]), aes(x = Action,y = change_sr_tran))+
  geom_boxplot()+
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") + 
  facet_wrap(~Year,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta SR by Year and Action", 
       x="Action",
       y="Change in SR")

#Plot hist of actual SR by Action and Year
stat_box_data <- function(y, upper_limit = max(cover[!is.na(sr_tran),sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Year,sr_tran,Action)]), aes(x = Action,y = sr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Year,nrow = 3)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="SR by Year and Action", 
       x="Action",
       y="SR")

```


```{r Richness - Spatial}

####Plot Latitude 

#Plot hist of change in SR by Lat and Action
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_sr_tran),change_sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_sr_tran)),.(TransectID,Year,change_sr_tran,Action,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = change_sr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta SR by Latitude and Action", 
       x="Latitude Category",
       y="Change in SR")

#Plot hist of actual SR by Lat and Action
stat_box_data <- function(y, upper_limit = max(cover[!is.na(sr_tran),sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(sr_tran)),.(TransectID,Year,sr_tran,Action,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = sr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="SR by Latitude and Action", 
       x="Latitude Category",
       y="SR")

####Plot Longitude

#Plot hist of change in SR by Long and Action
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_sr_tran),change_sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_sr_tran)),.(TransectID,Year,change_sr_tran,Action,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = change_sr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta SR by Longitude and Action", 
       x="Longitude Category",
       y="Change in SR")

#Plot hist of actual SR by Long and Action
stat_box_data <- function(y, upper_limit = max(cover[!is.na(sr_tran),sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(sr_tran)),.(TransectID,Year,sr_tran,Action,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = sr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="SR by Longitude and Action", 
       x="Longitude Category",
       y="Ch SR")


```

```{r Status Richness}
###First plot native and invasive richness overall 
#IR
hist(unique(cover[!(is.na(ir_tran))][,.(Year,TransectID,ir_tran)])[,ir_tran],freq = T,main = "ir - Transects",xlab = "Total ir",ylab = "Number of Transects",breaks = length(unique(cover[!(is.na(ir_tran)),ir_tran]))) #all

hist(unique(cover[!(is.na(change_ir_tran))][,.(Year,TransectID,change_ir_tran)])[,change_ir_tran],freq = T,main = "ir First Diff - Transects",xlab = "Delta ir",ylab = "Number of Transects",breaks = length(unique(cover[!(is.na(change_ir_tran)),change_ir_tran]))) #delta

hist(unique(cover[!(is.na(ir_mgmt))][,.(Year,MGMTUNIT_I,ir_mgmt)])[,ir_mgmt],freq = T,main = "ir - MGMT Units",xlab = "Total ir",ylab = "Number of MGMT Units",breaks = length(unique(cover[!(is.na(ir_mgmt)),ir_mgmt]))) #all

hist(unique(cover[!(is.na(change_ir_mgmt))][,.(Year,MGMTUNIT_I,change_ir_mgmt)])[,change_ir_mgmt],freq = T,main = "ir First Diff - MGMT Units",xlab = "Delta ir",ylab = "Number of MGMT Units",breaks = length(unique(cover[!(is.na(change_ir_mgmt)),change_ir_mgmt]))) #delta

#hist(unique(cover[!(is.na(ir_site))][,.(Year,SITE_ID,ir_site)])[,ir_site],freq = T,main = "ir - Sites",xlab = "Total ir",ylab = "Number of Sites",breaks = length(unique(cover[!(is.na(ir_site)),ir_site]))) #all

#hist(unique(cover[!(is.na(change_ir_site))][,.(Year,SITE_ID,change_ir_site)])[,change_ir_site],freq = T,main = "ir First Diff - Sites",xlab = "Delta ir",ylab = "Number of Sites",breaks = length(unique(cover[!(is.na(change_ir_site)),change_ir_site]))) #delta

#NR
hist(unique(cover[!(is.na(nr_tran))][,.(Year,TransectID,nr_tran)])[,nr_tran],freq = T,main = "nr - Transects",xlab = "Total nr",ylab = "Number of Transects",breaks = length(unique(cover[!(is.na(nr_tran)),nr_tran]))) #all

hist(unique(cover[!(is.na(change_nr_tran))][,.(Year,TransectID,change_nr_tran)])[,change_nr_tran],freq = T,main = "nr First Diff - Transects",xlab = "Delta nr",ylab = "Number of Transects",breaks = length(unique(cover[!(is.na(change_nr_tran)),change_nr_tran]))) #delta

hist(unique(cover[!(is.na(nr_mgmt))][,.(Year,MGMTUNIT_I,nr_mgmt)])[,nr_mgmt],freq = T,main = "nr - MGMT Units",xlab = "Total nr",ylab = "Number of MGMT Units",breaks = length(unique(cover[!(is.na(nr_mgmt)),nr_mgmt]))) #all

hist(unique(cover[!(is.na(change_nr_mgmt))][,.(Year,MGMTUNIT_I,change_nr_mgmt)])[,change_nr_mgmt],freq = T,main = "nr First Diff - MGMT Units",xlab = "Delta nr",ylab = "Number of MGMT Units",breaks = length(unique(cover[!(is.na(change_nr_mgmt)),change_nr_mgmt]))) #delta

#hist(unique(cover[!(is.na(nr_site))][,.(Year,SITE_ID,nr_site)])[,nr_site],freq = T,main = "nr - Sites",xlab = "Total nr",ylab = "Number of Sites",breaks = length(unique(cover[!(is.na(nr_site)),nr_site]))) #all

#hist(unique(cover[!(is.na(change_nr_site))][,.(Year,SITE_ID,change_nr_site)])[,change_nr_site],freq = T,main = "nr First Diff - Sites",xlab = "Delta nr",ylab = "Number of Sites",breaks = length(unique(cover[!(is.na(change_nr_site)),change_nr_site]))) #delta
   
```

Compare ir and nr relative to other factors
```{r Richness - Species Type comparison}

#######Plot ir and nr over time

#Plot hist of total IR by Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(ir_tran),ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Year,ir_tran)]), aes(x = Year,y = ir_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect IR by Year", 
       x="Year",
       y="IR")

#Plot hist of change in IR by Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_tran),change_ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_tran)),.(TransectID,Year,change_ir_tran)]), aes(x = Year,y = change_ir_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect IR by Year", 
       x="Action",
       y="Change in IR")

#Plot hist of change in IR by Year - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_mgmt),change_ir_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_mgmt)),.(MGMTUNIT_I,Year,change_ir_mgmt)]), aes(x = Year,y = change_ir_mgmt,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT IR by Year", 
       x="Action",
       y="Change in IR")

#Plot hist of total NR by Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(nr_tran),nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Year,nr_tran)]), aes(x = Year,y = nr_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect nr by Year", 
       x="Year",
       y="nr")

#Plot hist of change in NR by Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_tran),change_nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_tran)),.(TransectID,Year,change_nr_tran)]), aes(x = Year,y = change_nr_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect nr by Year", 
       x="Action",
       y="Change in nr")

#Plot hist of change in NR by Year - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_mgmt),change_nr_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_mgmt)),.(MGMTUNIT_I,Year,change_nr_mgmt)]), aes(x = Year,y = change_nr_mgmt,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT nr by Year", 
       x="Action",
       y="Change in nr")

#######Plot ir and nr relative to management action

#Plot hist of total IR by Action - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(ir_tran),ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,ir_tran)]), aes(x = Action,y = ir_tran,group=Action))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect IR by Action", 
       x="Action",
       y="IR")

#Plot hist of change in IR by Action - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_tran),change_ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_tran)),.(TransectID,Action,change_ir_tran)]), aes(x = Action,y = change_ir_tran,group=Action))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect IR by Action", 
       x="Action",
       y="Change in IR")

#Plot hist of change in IR by Action - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_mgmt),change_ir_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_mgmt)),.(MGMTUNIT_I,Action,change_ir_mgmt)]), aes(x = Action,y = change_ir_mgmt,group=Action))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT IR by Action", 
       x="Action",
       y="Change in IR")

#Plot hist of total NR by Action - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(nr_tran),nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,nr_tran)]), aes(x = Action,y = nr_tran,group=Action))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect nr by Action", 
       x="Action",
       y="nr")

#Plot hist of change in NR by Action - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_tran),change_nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_tran)),.(TransectID,Action,change_nr_tran)]), aes(x = Action,y = change_nr_tran,group=Action))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect nr by Action", 
       x="Action",
       y="Change in nr")

#Plot hist of change in NR by Action - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_mgmt),change_nr_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_mgmt)),.(MGMTUNIT_I,Action,change_nr_mgmt)]), aes(x = Action,y = change_nr_mgmt,group=Action))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT nr by Action", 
       x="Action",
       y="Change in nr")


#######Plot ir and nr over time * management action

#Plot hist of total IR by Action and Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(ir_tran),ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,Year,ir_tran)]), aes(x = Year,y = ir_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect IR by Year and Action", 
       x="Year",
       y="IR")

#Plot hist of change in IR by Action and Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_tran),change_ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_tran)),.(TransectID,Action,Year,change_ir_tran)]), aes(x = Year,y = change_ir_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect IR by Year and Action", 
       x="Year",
       y="Change in IR")

#Plot hist of change in IR by Action and Year - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_mgmt),change_ir_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_mgmt)),.(MGMTUNIT_I,Action,Year,change_ir_mgmt)]), aes(x = Year,y = change_ir_mgmt,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT IR by Year and Action", 
       x="Year",
       y="Change in IR")

#Plot hist of total NR by Action and Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(nr_tran),nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,Year,nr_tran)]), aes(x = Year,y = nr_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect nr by Year and Action", 
       x="Year",
       y="nr")

#Plot hist of change in NR by Action and Year - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_tran),change_nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_tran)),.(TransectID,Action,Year,change_nr_tran)]), aes(x = Year,y = change_nr_tran,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect nr by Year and Action", 
       x="Year",
       y="Change in nr")

#Plot hist of change in NR by Action and Year - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_mgmt),change_nr_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_mgmt)),.(MGMTUNIT_I,Action,Year,change_nr_mgmt)]), aes(x = Year,y = change_nr_mgmt,group=Year))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT nr by Year and Action", 
       x="Year",
       y="Change in nr")

######Plot ir and nr by management action * lat 

#Plot hist of total IR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(ir_tran),ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,Year,ir_tran,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = ir_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect IR by Latitude and Action", 
       x="Latitude Category",
       y="IR")

#Plot hist of change in IR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_tran),change_ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_tran)),.(TransectID,Action,Year,change_ir_tran,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = change_ir_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect IR by Latitude and Action", 
       x="Latitude Category",
       y="Change in IR")

#Plot hist of change in IR by Action and Lat - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_mgmt),change_ir_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_mgmt)),.(MGMTUNIT_I,Action,Year,change_ir_mgmt,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = change_ir_mgmt))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT IR by Latitude and Action", 
       x="Latitude Category",
       y="Change in IR")

#Plot hist of total NR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(nr_tran),nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,Year,nr_tran,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = nr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect nr by Latitude and Action", 
       x="Latitude Category",
       y="nr")

#Plot hist of change in NR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_tran),change_nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_tran)),.(TransectID,Action,Year,change_nr_tran,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = change_nr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect nr by Latitude and Action", 
       x="Latitude Category",
       y="Change in nr")

#Plot hist of change in NR by Action and Lat - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_mgmt),change_nr_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_mgmt)),.(MGMTUNIT_I,Action,Year,change_nr_mgmt,Lat.Cat,Long.Cat)]), aes(x = Lat.Cat,y = change_nr_mgmt))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT nr by Latitude and Action", 
       x="Latitude",
       y="Change in nr")

######Plot ir and nr by management action * lat 

#Plot hist of total IR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(ir_tran),ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,Year,ir_tran,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = ir_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect IR by Longitude and Action", 
       x="Longitude Category",
       y="IR")

#Plot hist of change in IR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_tran),change_ir_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_tran)),.(TransectID,Action,Year,change_ir_tran,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = change_ir_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect IR by Longitude and Action", 
       x="Longitude Category",
       y="Change in IR")

#Plot hist of change in IR by Action and Lat - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_ir_mgmt),change_ir_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_ir_mgmt)),.(MGMTUNIT_I,Action,Year,change_ir_mgmt,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = change_ir_mgmt))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT IR by Longitude and Action", 
       x="Longitude Category",
       y="Change in IR")

#Plot hist of total NR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(nr_tran),nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action==""),.(TransectID,Action,Year,nr_tran,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = nr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Transect nr by Longitude and Action", 
       x="Longitude Category",
       y="nr")

#Plot hist of change in NR by Action and Lat - transects
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_tran),change_nr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_tran)),.(TransectID,Action,Year,change_nr_tran,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = change_nr_tran))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta Transect nr by Longitude and Action", 
       x="Longitude Category",
       y="Change in nr")

#Plot hist of change in NR by Action and Lat - Mgmt units
stat_box_data <- function(y, upper_limit = max(cover[!is.na(change_nr_mgmt),change_nr_mgmt]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="")&!(is.na(change_nr_mgmt)),.(MGMTUNIT_I,Action,Year,change_nr_mgmt,Lat.Cat,Long.Cat)]), aes(x = Long.Cat,y = change_nr_mgmt))+
  geom_boxplot()+   stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  facet_wrap(~Action,nrow = 2)+
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Delta MGMT UNIT nr by Longitude and Action", 
       x="Longitude",
       y="Change in nr")


```



#Climate Indices Exploration and Analysis 
##Climate indices correlations
We can and should expect some of these climate indices to covary through time, plot them relative to one another to parse this out.

```{r Index Covariates}
library(corrplot)

#Master correlation plot
indices <- cover.climate[, .(txx,tn90p,tx90p,rx5.w,rx5.sp,rx5.sum,rx5.y,fd,gsl,wsdi,csdi,sdii,cdd,cwd,prcpt)]
indices <- na.omit(indices)
setnames(indices,old = c('txx','tn90p','tx90p','rx5.w','rx5.sp','rx5.sum','rx5.y','fd','gsl','wsdi','csdi','sdii','cdd','cwd','prcpt'),
         new = c('Max T', 'Warm Winter Low', 'Warm Winter High','5-day P-win','5-day P-spr','5-day P-sum','5-day P-yr', 'Frost Days', 'Growing Season', 'Warm Spell', 'Cold Spell', 'SDII', 'Con Dry Days', 'Con Wet Days', 'Tot Precip'))

res1 <- cor.mtest(indices, conf.level = .95)

corrplot(cor(indices), method="number",p.mat = res1$p, insig = "blank", number.cex = 0.7)

#GSL Correlation
indices.gsl <- cover.climate[, .(rx5.sp,rx5.sum,gsl,wsdi,csdi,sdii,cdd,cwd,prcpt)]
indices.gsl <- na.omit(indices.gsl)

gsl1 <- cor.mtest(indices.gsl, conf.level = .95)

corrplot(cor(indices.gsl), method="number",p.mat = gsl1$p, insig = "blank", number.cex = 0.7)



```





#Analysis Graphs and Charts

##Cluster Analysis
```{r Cluster Graphs} 
setwd("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis")
load("cluster.rda")

###Visualize
#Taxon
fviz_cluster(list(data = ic.avg.df, cluster = clust.avg.3), data = ic.avg.clust,
             show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Taxon")+
  geom_point(data =ic.avg.clust, aes(x=f.change,y=cov.change,colour = Type),size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)
  
#Duration
fviz_cluster(list(data = ic.avg.df, cluster = clust.avg.3), data = ic.avg.clust,
             show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Duration")+
  geom_point(data =ic.avg.clust, aes(x=f.change,y=cov.change,group = Duration,colour = Duration),size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)

#Photopath
fviz_cluster(list(data = ic.avg.df, cluster = clust.avg.5), data = ic.avg.clust,
             show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Photopath")+
  geom_point(data =ic.avg.clust, aes(x=f.change,y=cov.change, group = Photopath, colour = Photopath) ,size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)

#Range
fviz_cluster(list(data = ic.avg.df, cluster = clust.avg.5), data = ic.avg.clust,
             show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Range")+
  geom_point(data =ic.avg.clust, aes(x=f.change,y=cov.change, group = Range, colour = Range) ,size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)

#Distribution
fviz_cluster(list(data = ic.avg.df, cluster = clust.avg.5), data = ic.avg.clust,
             show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Distribution")+
  geom_point(data =ic.avg.clust, aes(x=f.change,y=cov.change, group = Distribution, colour = Distribution) ,size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)
  


#Plot Type
ggplot(data = ic.yr.dt[,.(count = .N),by = .(Type, clust.2,Year)], aes(x=Type, y = count))+
  geom_bar(aes(fill = factor(clust.2)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Type by Two Clusters",x ="Type", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Type, clust.3,Year)], aes(x=Type, y = count))+
  geom_bar(aes(fill = factor(clust.3)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Type by Three Clusters",x ="Type", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Type, clust.4,Year)], aes(x=Type, y = count))+
  geom_bar(aes(fill = factor(clust.4)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Type by Four Clusters",x ="Type", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Type, clust.5,Year)], aes(x=Type, y = count))+
  geom_bar(aes(fill = factor(clust.5)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Type by Five Clusters",x ="Type", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Type, clust.6,Year)], aes(x=Type, y = count))+
  geom_bar(aes(fill = factor(clust.6)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Type by Six Clusters",x ="Type", y = "Cluster Count")

#Plot Duration
ggplot(data = ic.yr.dt[Duration=="Annual"|Duration=="Perennial",.(count = .N),by = .(Duration, clust.2,Year)], aes(x=Duration, y = count))+
  geom_bar(aes(fill = factor(clust.2)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Duration by Two Clusters",x ="Duration", y = "Cluster Count")

ggplot(data = ic.yr.dt[Duration=="Annual"|Duration=="Perennial",.(count = .N),by = .(Duration, clust.3,Year)], aes(x=Duration, y = count))+
  geom_bar(aes(fill = factor(clust.3)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Duration by Three Clusters",x ="Duration", y = "Cluster Count")

ggplot(data = ic.yr.dt[Duration=="Annual"|Duration=="Perennial",.(count = .N),by = .(Duration, clust.4,Year)], aes(x=Duration, y = count))+
  geom_bar(aes(fill = factor(clust.4)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Duration by Four Clusters",x ="Duration", y = "Cluster Count")

ggplot(data = ic.yr.dt[Duration=="Annual"|Duration=="Perennial",.(count = .N),by = .(Duration, clust.5,Year)], aes(x=Duration, y = count))+
  geom_bar(aes(fill = factor(clust.5)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Duration by Five Clusters",x ="Duration", y = "Cluster Count")

ggplot(data = ic.yr.dt[Duration=="Annual"|Duration=="Perennial",.(count = .N),by = .(Duration, clust.6,Year)], aes(x=Duration, y = count))+
  geom_bar(aes(fill = factor(clust.6)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Duration by Six Clusters",x ="Duration", y = "Cluster Count")

#Plot Photopath
##Not enough

#Plot Legume
ggplot(data = ic.yr.dt[,.(count = .N),by = .(Legume, clust.2,Year)], aes(x=Legume, y = count))+
  geom_bar(aes(fill = factor(clust.2)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Legume by Two Clusters",x ="Legume", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Legume, clust.3,Year)], aes(x=Legume, y = count))+
  geom_bar(aes(fill = factor(clust.3)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Legume by Three Clusters",x ="Legume", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Legume, clust.4,Year)], aes(x=Legume, y = count))+
  geom_bar(aes(fill = factor(clust.4)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Legume by Four Clusters",x ="Legume", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Legume, clust.5,Year)], aes(x=Legume, y = count))+
  geom_bar(aes(fill = factor(clust.5)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Legume by Five Clusters",x ="Legume", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Legume, clust.6,Year)], aes(x=Legume, y = count))+
  geom_bar(aes(fill = factor(clust.6)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Legume by Six Clusters",x ="Legume", y = "Cluster Count")

 #Plot Range
ggplot(data = ic.yr.dt[,.(count = .N),by = .(Range, clust.2,Year)], aes(x=Range, y = count))+
  geom_bar(aes(fill = factor(clust.2)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Range by Two Clusters",x ="Range", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Range, clust.3,Year)], aes(x=Range, y = count))+
  geom_bar(aes(fill = factor(clust.3)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Range by Three Clusters",x ="Range", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Range, clust.4,Year)], aes(x=Range, y = count))+
  geom_bar(aes(fill = factor(clust.4)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Range by Four Clusters",x ="Range", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Range, clust.5,Year)], aes(x=Range, y = count))+
  geom_bar(aes(fill = factor(clust.5)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Range by Five Clusters",x ="Range", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Range, clust.6,Year)], aes(x=Range, y = count))+
  geom_bar(aes(fill = factor(clust.6)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Range by Six Clusters",x ="Range", y = "Cluster Count")

#Plot Distribution
ggplot(data = ic.yr.dt[,.(count = .N),by = .(Distribution, clust.2,Year)], aes(x=Distribution, y = count))+
  geom_bar(aes(fill = factor(clust.2)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Distribution by Two Clusters",x ="Distribution", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Distribution, clust.3,Year)], aes(x=Distribution, y = count))+
  geom_bar(aes(fill = factor(clust.3)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Distribution by Three Clusters",x ="Distribution", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Distribution, clust.4,Year)], aes(x=Distribution, y = count))+
  geom_bar(aes(fill = factor(clust.4)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Distribution by Four Clusters",x ="Distribution", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Distribution, clust.5,Year)], aes(x=Distribution, y = count))+
  geom_bar(aes(fill = factor(clust.5)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Distribution by Five Clusters",x ="Distribution", y = "Cluster Count")

ggplot(data = ic.yr.dt[,.(count = .N),by = .(Distribution, clust.6,Year)], aes(x=Distribution, y = count))+
  geom_bar(aes(fill = factor(clust.6)), stat="identity",position = "stack", width = 0.5,show.legend = F)+
  facet_wrap(~Year,ncol = 4)+
  labs(title="Distribution by Six Clusters",x ="Distribution", y = "Cluster Count")


###Visualize
##3 Clusters

#Taxon
for (i in 1:length(Years)) {
Taxon = fviz_cluster(list(data = ic.avg.df.2[ic.avg.df.2$Year==Years[i],1:2], cluster = clust.yr.3[(yr.count[i]+1):yr.count[i+1]]), 
             data = ic.yr.clust[ic.yr.clust$Year==Years[i],], show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Taxon")+
  geom_point(data = ic.yr.clust[ic.yr.clust$Year==Years[i],], aes(x=f.change,y=cov.change,colour = Type),size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)
print(Taxon)
  
#Duration
Duration = fviz_cluster(list(data = ic.avg.df.2[ic.avg.df.2$Year==Years[i],1:2], cluster = clust.yr.3[(yr.count[i]+1):yr.count[i+1]]), 
             data = ic.yr.clust[ic.yr.clust$Year==Years[i],], show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Duration")+
  geom_point(data = ic.yr.clust[ic.yr.clust$Year==Years[i],], aes(x=f.change,y=cov.change,group = Duration,colour = Duration),size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)
print(Duration)

#Photopath
Photo = fviz_cluster(list(data = ic.avg.df.2[ic.avg.df.2$Year==Years[i],1:2], cluster = clust.yr.3[(yr.count[i]+1):yr.count[i+1]]), 
             data = ic.yr.clust[ic.yr.clust$Year==Years[i],], show.clust.cent = FALSE, axes = c(1,2), repel = T, geom = c("text"),
             ellipse = T,  ellipse.type = "convex", ellipse.alpha = 0, labelsize = 7,
             xlab = "Change in Frequency", ylab = "Change in Cover",main = "Cluster plot - Photopath")+
  geom_point(data = ic.yr.clust[ic.yr.clust$Year==Years[i],], aes(x=f.change,y=cov.change, group = Photopath, colour = Photopath) ,size=2) +
  guides(size = FALSE, shape=FALSE, group = FALSE)
print(Photo)
}


```

##Observer Effects
```{r Observer Sensitivity} 
#Visualize how SR varies with observer id
stat_box_data <- function(y, upper_limit = max(cover[!is.na(sr_tran),sr_tran]) * 1.15) {
  return( data.frame(y = 1 * upper_limit,label = paste('',length(y),'\n')))}

ggplot(unique(cover[!(Action=="") & !(is.na(sr_tran)),.(TransectID,ObsCode,sr_tran)]), aes(x = ObsCode,y = sr_tran,group=ObsCode))+
  geom_boxplot()+   
  stat_summary(fun.data = stat_box_data, geom = "text", hjust = 0.5,vjust = 0.9,size=3,colour="blue") +    
  theme(axis.text.x = element_text(angle=0, vjust=0.6)) + 
  labs(title="Richness Counts by Observer", 
       x="Observer",
       y="SR")

#Lets look at a scatter plot


```


##Pre-model index-metric relationships

###Txx
```{r Indices and Invasion - txx}

#visualize txx variability....hmm not a whole lot of variability here. 
ggplot(cover.climate, aes(x=val.mth)) +
  geom_histogram(binwidth=1,color="black", fill="white") +
  facet_wrap(~Year)

#how do these values vary spatially? Use latitude since that is more likely predicted to correlate with temp
#ggplot(cover.climate, aes(x=val.mth,color=Lat.Cat,fill=Lat.Cat)) +
  #geom_histogram(binwidth=1,alpha=0.5, position="identity") +
  #facet_wrap(~Year)

#How about variability between action types
ggplot(cover.climate, aes(x=val.mth,color=Action,fill=Action)) +
  geom_histogram(binwidth=1,alpha=0.5, position="identity") +
  facet_wrap(~Year)

#Visualize a simple relationship between abundace (IR, IF, IR rel cover, IR dominance) and TXx
#IR
ggplot(cover.climate, aes(x=txx ,y=ir_tran, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title    = "Invasive Richness vs. Max Yearly Temp (TXx)", x="Max Temp (C)", y="Transect Invasive Richness")

#IF
ggplot(cover.climate, aes(x=txx ,y=if.tran, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Invasive Frequency vs. Max Yearly Temp (TXx)", x="Max Temp (C)", y="Transect Invasive Frequency")


#Invasive relative cover
ggplot(cover.climate, aes(x=txx ,y=rel.cov.i.2, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Total invasive Relative Cover vs. Max Yearly Temp (TXx)", x="Max Temp (C)", y="Transect Invasive Frequency")


#Mean DI invasives
ggplot(cover.climate, aes(x=txx ,y= meanDI.i.tran.2, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Mean Invasive Dominance vs. Max Yearly Temp (TXx)", x="Max Temp (C)", y="Transect Invasive Frequency")


```



###TN90P
```{r Indices and Invasion - TN90P}
#visualize tn90p variability
ggplot(cover.climate, aes(x=val.mth)) +
  geom_histogram(binwidth=1,color="black", fill="white") 

ggplot(cover.climate, aes(x=val.mth)) +
  geom_histogram(binwidth=1,color="black", fill="white") +
  facet_wrap(~Year)

#How about variability between action types
ggplot(cover.climate, aes(x=val.mth,color=Action,fill=Action)) +
  geom_histogram(binwidth=1,alpha=0.5, position="identity") +
  facet_wrap(~Year)

#Visualize a simple relationship between abundace (IR, IF, IR rel cover, IR dominance) and tn90p
ggplot(cover.climate, aes(x=val.mth,y=ir_tran, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title    = "Invasive Richness vs. Percentage of Abnormally Warm Daily Lows", x="% Winter days with coldestt temp in 90th percentile", y="Transect Invasive Richness")

ggplot(dt.cover.tn90p.2, aes(x=val.mth,y=if.tran, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Invasive Frequency vs. Percentage of Abnormally Warm Daily Lows", x="% Winter days with coldestt temp in 90th percentile", y="Transect Invasive Frequency")

```

###gsl
```{r Indices and Invasion - gsl}

#visualize gsl variability....hmm not a whole lot of variability here. 
ggplot(cover.climate, aes(x=gsl)) +
  geom_histogram(binwidth=1,color="black", fill="white") +
  facet_wrap(~Year)

#how do these values vary spatially? Use latitude since that is more likely predicted to correlate with temp
#ggplot(cover.climate, aes(x=gsl,color=Lat.Cat,fill=Lat.Cat)) +
  #geom_histogram(binwidth=1,alpha=0.5, position="identity") +
  #facet_wrap(~Year)

#How about variability between action types
ggplot(cover.climate, aes(x=gsl,color=Action,fill=Action)) +
  geom_histogram(binwidth=1,alpha=0.5, position="identity") +
  facet_wrap(~Year)

#Visualize a simple relationship between abundace (IR, IF, IR rel cover, IR dominance) and gsl
#IR
ggplot(cover.climate, aes(x=gsl ,y=ir_tran, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title    = "Invasive Richness vs. Growing Season Length (gsl)", x="GSL (days)", y="Transect Invasive Richness")

#IF
ggplot(cover.climate, aes(x=gsl ,y=if.tran, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Invasive Frequency vs. Growing Season Length (gsl)", x="GSL (days)", y="Transect Invasive Frequency")


#Invasive relative cover
ggplot(cover.climate, aes(x=gsl ,y=rel.cov.i.2, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Total invasive Relative Cover vs. Growing Season Length (gsl)", x="GSL (days)", y="Transect Invasive Frequency")


#Mean DI invasives
ggplot(cover.climate, aes(x=gsl ,y= meanDI.i.tran.2, color=Action, group = Action)) +
  geom_point(size=0.3, alpha = 0.5,position="jitter")+
  theme_minimal()+
  theme(legend.position = "none")+
  geom_smooth(method = lm,
             se = FALSE,
              size = 1,
              alpha = 1)+
  labs(title = "Mean Invasive Dominance vs. Growing Season Length (gsl)", x="GSL (days)", y="Transect Invasive Frequency")


```



#Model Results

##Growing Season Length

###Transect Level

####Fixed Effects
```{r GSL-FE}
#Load Data
setwd("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis")
load("model_GSL_FE_tran.rda")

########Transect Means

#Plot effects: all response variable per model type
coeff.dt = data.frame()
plots.grow = list()
for (k in 1:(length(grow.model.terms$grow.response)/(length(resp.cnt)*length(status)))) {
  coeff.dt = data.frame()
    for (i in 1:(length(resp.cnt)*length(status))) {
    coeff.dt = rbind(coeff.dt,grow.m.coeffs[[i+((length(resp.cnt)*length(status))*(k-1))]])
    }
  coeff.dt$response = rep(grow.model.terms[((4*k -3):(4*k)),grow.response],each = length(coeff.dt$term)/(length(resp.cnt)*length(status)))
  
  row.ref = (1+((length(resp.cnt)*length(status))*(k-1)))
  plots.grow[[k]] = ggplot(data = coeff.dt ,aes(x=term, y=estimate, ymin=conf.low, ymax=conf.high)) +
  geom_pointrange() +
  facet_wrap(~response)+
  labs(title = "Effects on Invasive Species - FE Model",subtitle = paste( "~", noquote(grow.model.terms[row.ref,grow.index]),noquote(grow.model.terms[row.ref,grow.variant]),
                        noquote(grow.model.terms[row.ref,grow.interact]), "| TransectID",sep = " ")) +
  theme(plot.subtitle=element_text(size=8, face="italic", color="black"))+
  geom_hline(yintercept = 0, col = "orange") +
  coord_flip(ylim = c(-0.5,0.5)) +
  #labs(title = "Effects on Invasive Richness") + 
  theme(axis.title.x = element_blank(),axis.title.y = element_blank())
 }

print(plots.grow)

########Groups

first.run = length(grow.model.terms.grp$grow.response)/(length(resp.cnt) * length(status) * length(categories.grp) * length(groups))
second.run =length(categories.grp) * length(groups)
third.run = length(resp.cnt) * length(status)


#Plot effects: all response variable per model type
coeff.grp.dt = data.frame()
coef.resp = c()
coef.grp = c()
plots.grow.grp = list()
for (k in 1:first.run) {
  for (i in 1:second.run){
    coeff.grp.dt=data.frame()
    coef.resp = c()
    coef.grp = c()
    coef.status = c()
    for (r in 1:third.run){
      coeff.grp.dt = rbind(coeff.grp.dt,
                       grow.grp.coeffs[[ r + (third.run *(i-1)) + (third.run*second.run*(k-1))]])
     
       coef.resp = c(coef.resp, 
                    as.character(rep(grow.model.terms.grp[r + (third.run *(i-1)) + (third.run*second.run*(k-1)), grow.response.grp],
                        each = length(grow.grp.coeffs[[r + (third.run *(i-1)) + (third.run*second.run*(k-1))]]$term))))
      
       coef.grp = c(coef.grp, 
                    as.character(rep(grow.model.terms.grp[r + (third.run *(i-1)) + (third.run*second.run*(k-1)), groups ],
                        each = length(grow.grp.coeffs[[r + (third.run *(i-1)) + (third.run*second.run*(k-1))]]$term))))
       
       coef.status = c(coef.status,
                       as.character(rep(grow.model.terms.grp[r + (third.run *(i-1)) + (third.run*second.run*(k-1)), status ],
                        each = length(grow.grp.coeffs[[r + (third.run *(i-1)) + (third.run*second.run*(k-1))]]$term))))
       }
      
    coeff.grp.dt = cbind(coeff.grp.dt,coef.grp,coef.resp,coef.status)
  
  #Now plot using this coefficient table  
  row.ref = (1+(third.run*(i-1))+(third.run*second.run*(k-1)))
  
  plots.grow.grp[[paste("FE", grow.model.terms.grp[row.ref, groups],grow.model.terms.grp[row.ref, categories.grp],  "~",
                        grow.model.terms.grp[row.ref, sorting], "| TransectID",sep = " ")]] = 
    ggplot(data = coeff.grp.dt, aes(x=term, y=estimate, ymin=conf.low, ymax=conf.high, color=coef.status)) +
  geom_pointrange(position = position_dodge(width = 0.5)) +
  facet_wrap(~coef.resp)+
  labs(title = "Effects on Invasive Species - FE Model", 
       subtitle = paste( "~", noquote(grow.model.terms.grp[row.ref, sorting]), "| TransectID",sep = " ")) +
  theme(plot.subtitle=element_text(size=5, face="italic", color="black"))+
  geom_hline(yintercept = 0, col = "orange") +
  coord_flip(ylim = c(-0.5,0.5)) +
  #labs(title = "Effects on Invasive Richness") +
  theme(axis.title.x = element_blank(),axis.title.y = element_blank())
  }
}
  
print(plots.grow.grp)

#Save the plots to look at outside of Rmd...work on sorting out the formating
setwd("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis/Plots and Figures/Rough")
lapply(names(plots.grow.grp), 
  function(x)ggsave(filename=paste(x,".jpeg",sep=""), plot=plots.grow.grp[[x]]))

```

####Lagged Effects
```{r GSL-LE}
#Load Data
setwd("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis")
load("model_GSL_FE_tran.rda")

########Transect Means
#Plot effects: all response variable per model type
coeff.dt = data.frame()
plots.grow.lag = list()
for (k in 1:(length(grow.lag.terms$grow.lag)/length(grow.lag))) {
  coeff.dt = data.frame()
    for (i in 1:length(grow.lag)) {
    coeff.dt = rbind(coeff.dt,growing.lagged.coeffs[[i+(length(grow.lag)*(k-1))]])
    }
  coeff.dt$response = rep(grow.lag,each = length(coeff.dt$term)/length(grow.lag))
  
  row.ref = (1+(length(grow.lag)*(k-1)))
  plots.grow.lag[[k]] = ggplot(data = coeff.dt ,aes(x=term, y=estimate, ymin=conf.low, ymax=conf.high)) +
  geom_pointrange() +
  coord_flip() +
  facet_wrap(~response)+
  labs(title = "Effects on Invasive Species - LE Model",subtitle = paste( "~", noquote(grow.lag.terms[row.ref,grow.index]),noquote(grow.lag.terms[row.ref,grow.variant]),
                        noquote(grow.lag.terms[row.ref,grow.interact]),sep = " ")) +
  theme(plot.subtitle=element_text(size=8, face="italic", color="black"))+
  geom_hline(yintercept = 0, col = "orange") +
  ylim(-0.3, 0.3 ) +
  theme(axis.title.x = element_blank(),axis.title.y = element_blank())
}

 print(plots.grow.lag)

########Groups
#Plot effects: all response variable per model type
coeff.grp.dt = data.frame()
coef.resp = c()
coef.grp = c()
plots.grow.grp.lag = list()
for (k in 1:(length(grow.lag.terms.grp$grow.lag.grp)/(length(grow.lag.grp)))) {
  for (i in 1:length(groups)){
    coeff.grp.dt=data.frame()
    coef.resp = c()
    coef.grp = c()
    for (r in 1:(length(grow.lag.grp)/length(groups))){
      coeff.grp.dt = rbind(coeff.grp.dt,
                       growing.lagged.coeffs.grp[[ r + (length(grow.lag.grp)/length(groups)*(i-1)) + (length(groups)*(length(grow.lag.grp)/length(groups)*(k-1)))]])
     
       coef.resp = c(coef.resp, 
                    rep(grow.lag.grp[r+(length(grow.lag.grp)/length(groups)*(i-1))] ,each = length(growing.lagged.coeffs.grp[[r + (length(grow.lag.grp)/length(groups)*(i-1)) + (length(groups)*(length(grow.lag.grp)/length(groups)*(k-1)))]]$term)))
      
       coef.grp = c(coef.grp, 
                    rep(grow.lag.grp[r+(length(grow.lag.grp)/length(groups)*(i-1))] ,each = length(growing.lagged.coeffs.grp[[r + (length(grow.lag.grp)/length(groups)*(i-1)) + (length(groups)*(length(grow.lag.grp)/length(groups)*(k-1)))]]$term)))
       }
      
    coeff.grp.dt = cbind(coeff.grp.dt,coef.grp,coef.resp)
  
  #Now plot using this coefficient table  
  row.ref = (1+((length(grow.lag.grp)/length(groups))*(i-1))+(length(grow.lag.grp)*(k-1)))
  
  plots.grow.grp.lag[[i+(length(groups)*(k-1))]] = ggplot(data = coeff.grp.dt ,aes(x=term, y=estimate, ymin=conf.low, ymax=conf.high)) +
  geom_pointrange() +
  coord_flip() +
  facet_wrap(~coef.resp)+
  labs(title = "Effects on Invasive Species - FE Model",subtitle = paste( "~", noquote(grow.lag.terms.grp[row.ref,grow.index.grp]),noquote(grow.lag.terms.grp[row.ref,grow.variant.grp]),
                        noquote(grow.lag.terms.grp[row.ref,grow.interact.grp]), "| TransectID",sep = " ")) +
  theme(plot.subtitle=element_text(size=5, face="italic", color="black"))+
  geom_hline(yintercept = 0, col = "orange") +
  ylim(-0.3, 0.3 ) +
  #labs(title = "Effects on Invasive Richness") +
  theme(axis.title.x = element_blank(),axis.title.y = element_blank())
  }
}
  
print(plots.grow.grp.lag)

```

###Species Level

####Fixed Effects

```{r GSL-FE-species }

#Load Data
setwd("/Volumes/GoogleDrive/My Drive/Thesis/Prairies/Data And Analysis/Prairie Analysis/Prairie-Analysis")
load("model_GSL_FE_spec.rda")

########Species Means

length(imp.spec)

#Plot effects: all response variable per model type
coeff.dt = data.frame()
plots.grow.species = list()
for (k in 1:(length(grow.spec.terms$grow.response.spec)/length(unique(grow.spec.terms$grow.response.spec)))) {
  coeff.dt = data.frame()
  for (i in 1:length(unique(grow.spec.terms$grow.response.spec))) {
  coeff.dt = rbind(coeff.dt,
                   grow.spec.coeffs[[i+(length(unique(grow.spec.terms$grow.response.spec))*(k-1))]])
    }
  coeff.dt$response = rep(grow.spec.terms[((3*k -2):(3*k)),grow.response.spec],each = length(coeff.dt$term)/length(unique(grow.spec.terms$grow.response.spec)))
  
  coeff.dt$species = rep(grow.spec.terms[((3*k -2):(3*k)),imp.spec],each = length(coeff.dt$term)/length(unique(grow.spec.terms$grow.response.spec)))
  
  row.ref = (1+(length(unique(grow.spec.terms$grow.response.spec))*(k-1)))
  
  plots.grow.spec[[k]] = ggplot(data = coeff.dt ,aes(x=term, y=estimate, ymin=conf.low, ymax=conf.high)) +
  geom_pointrange() +
  facet_wrap(~response)+
  labs(title = paste("Effects on Important Species - FE Model", "Species =",noquote(grow.spec.terms[row.ref,imp.spec])),subtitle = paste("~", noquote(grow.spec.terms[row.ref,grow.index.spec]),noquote(grow.spec.terms[row.ref,grow.variant.spec]),
                        noquote(grow.spec.terms[row.ref,grow.interact.spec]), "| TransectID",sep = " ")) +
  theme(plot.subtitle=element_text(size=8, face="italic", color="black"))+
  geom_hline(yintercept = 0, col = "orange") +
  coord_flip(ylim = c(-0.5,0.5)) +
  #labs(title = "Effects on Invasive Richness") + 
  theme(axis.title.x = element_blank(),axis.title.y = element_blank())
 }

print(plots.grow.spec)




```
